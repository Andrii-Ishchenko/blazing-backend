version: '3'
services:
  frontend:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.server
    ports:
    - "64589:80"
    depends_on:
      - delivery
      - menu
      - orders
    environment: 
      ASPNETCORE_ENVIRONMENT: Development
      DATA__DIRECTORY: /var/lib/db
    volumes:
      - data-volume:/var/lib/db
  delivery:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.delivery
    depends_on:
      - redis
    environment: 
      ASPNETCORE_ENVIRONMENT: Development
      REDIS__SERVICE: "redis:6379" 
  menu:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.menu
    environment: 
      ASPNETCORE_ENVIRONMENT: Development
      DATA__DIRECTORY: /var/lib/db
    volumes:
      - data-volume:/var/lib/db
  orders:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.orders
    depends_on:
      - redis
    environment: 
      ASPNETCORE_ENVIRONMENT: Development
      DATA__DIRECTORY: /var/lib/db
      REDIS__SERVICE: "redis:6379" 
    volumes:
      - data-volume:/var/lib/db
  redis:
    image: redis
volumes:
  data-volume: